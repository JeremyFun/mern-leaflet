{"ast":null,"code":"import _defineProperty from\"/home/kango/Documents/MERN Projects/react-leaflet-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/home/kango/Documents/MERN Projects/react-leaflet-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/home/kango/Documents/MERN Projects/react-leaflet-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/kango/Documents/MERN Projects/react-leaflet-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/kango/Documents/MERN Projects/react-leaflet-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/kango/Documents/MERN Projects/react-leaflet-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import'./App.css';import{Map,TileLayer,Marker,Popup}from'react-leaflet';import L from'leaflet';import Joi from'joi';import{CardText,CardBody,CardTitle,Button,Form,FormGroup,Label,Input}from'reactstrap';import messageIcon from\"./message-location.svg\";import myIcon from\"./my-location.svg\";export var messagesIcon=new L.Icon({iconUrl:messageIcon,iconSize:[35,38],iconAnchor:[13.5,41],popupAnchor:[0,-41]});export var myIcons=new L.Icon({iconUrl:myIcon,iconSize:[35,38],iconAnchor:[13.5,41],popupAnchor:[0,-41]});var schema=Joi.object().keys({name:Joi.string().min(1).max(500).required(),message:Joi.string().min(1).max(500).required()});var API_URL=window.location.hostname==='localhost'?'http://localhost:5000/api/v1/messages':'production_url_here';var App=/*#__PURE__*/function(_React$Component){_inherits(App,_React$Component);var _super=_createSuper(App);function App(){var _this;_classCallCheck(this,App);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={location:{lat:50.433300,lng:30.416700},haveUserLocation:false,zoom:2,userMessage:{name:'',message:''},sendingMessage:false,sentMessage:false,messages:[]};_this.formIsValid=function(){var userMessage={name:_this.state.userMessage.name,message:_this.state.userMessage.message};var result=schema.validate(userMessage);if(_this.state.haveUserLocation){if(!result.error){return true;}return false;}};_this.formSubmitted=function(event){event.preventDefault();_this.setState({sendingMessage:true});if(_this.formIsValid()){debugger;fetch(API_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name:_this.state.userMessage.name,message:_this.state.userMessage.message,latitude:_this.state.location.lat,longitude:_this.state.location.lng})}).then(function(res){return res.json();}).then(function(message){console.log(message);setTimeout(function(){_this.setState({sendingMessage:false,sentMessage:true});},4000);});}};_this.valueChanged=function(event){var _event$target=event.target,name=_event$target.name,value=_event$target.value;_this.setState(function(prevState){return{userMessage:_objectSpread(_objectSpread({},prevState.userMessage),{},_defineProperty({},name,value))};});};return _this;}_createClass(App,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;fetch(API_URL).then(function(res){return res.json();}).then(function(messages){var haveSeenLocation={};messages=messages.reduce(function(all,message){debugger;var key=\"\".concat(message.latitude.toFixed(2)).concat(message.longitude.toFixed(2));if(haveSeenLocation[key]){console.log(haveSeenLocation[key],'key');haveSeenLocation[key].otherMessages=haveSeenLocation[key].otherMessages||[];haveSeenLocation[key].otherMessages.push(message);}else{haveSeenLocation[key]=message;all.push(message);}return all;},[]);_this2.setState({messages:messages});});navigator.geolocation.getCurrentPosition(function(position){_this2.setState({location:{lat:position.coords.latitude,lng:position.coords.longitude},haveUserLocation:true,zoom:13});},function(){console.log('uh, oh... they didnt give us their location...');fetch('http://ip-api.com/json/').then(function(res){return res.json();}).then(function(location){_this2.setState({location:{lat:location.lat,lng:location.lon},haveUserLocation:true,zoom:13});});});}},{key:\"render\",value:function render(){var position=[this.state.location.lat,this.state.location.lng];return/*#__PURE__*/React.createElement(\"div\",{className:\"map\"},/*#__PURE__*/React.createElement(Map,{className:\"map\",center:position,zoom:this.state.zoom},/*#__PURE__*/React.createElement(TileLayer,{attribution:\"&copy <a href=\\\"http://osm.org/copyright\\\">OpenStreetMap</a> contributors\",url:\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"}),this.state.haveUserLocation?/*#__PURE__*/React.createElement(Marker,{position:position,icon:myIcons},/*#__PURE__*/React.createElement(Popup,null,\"A pretty CSS3 popup. \",/*#__PURE__*/React.createElement(\"br\",null),\" Easily customizable.\")):\"\",this.state.messages.map(function(message){return/*#__PURE__*/React.createElement(Marker,{key:message._id,position:[message.latitude,message.longitude],icon:messagesIcon},/*#__PURE__*/React.createElement(Popup,null,/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"em\",null,message.name),message.message),message.otherMessages?message.otherMessages.map(function(message){return/*#__PURE__*/React.createElement(\"p\",{key:message._id},/*#__PURE__*/React.createElement(\"em\",null,message.name),\" : \",message.message);}):\"\"));})),/*#__PURE__*/React.createElement(CardBody,{className:\"message-form\"},/*#__PURE__*/React.createElement(CardTitle,null,\"Welcome to GuestM.app\"),/*#__PURE__*/React.createElement(CardText,null,\"Leave a message with your location!\"),/*#__PURE__*/React.createElement(CardText,null,\"Thanks for stopping by!\"),!this.state.sendingMessage&&!this.state.sentMessage&&this.state.haveUserLocation?/*#__PURE__*/React.createElement(Form,{onSubmit:this.formSubmitted},/*#__PURE__*/React.createElement(FormGroup,null,/*#__PURE__*/React.createElement(Label,{for:\"name\"},\"Name\"),/*#__PURE__*/React.createElement(Input,{onChange:this.valueChanged,type:\"text\",name:\"name\",id:\"name\",placeholder:\"Enter your name\"})),/*#__PURE__*/React.createElement(FormGroup,null,/*#__PURE__*/React.createElement(Label,{for:\"message\"},\"Message\"),/*#__PURE__*/React.createElement(Input,{onChange:this.valueChanged,type:\"textarea\",name:\"message\",id:\"message\",placeholder:\"Enter a message\"})),/*#__PURE__*/React.createElement(Button,{type:\"submit\",color:\"info\",disabled:!this.formIsValid()},\"Send\")):this.state.sendingMessage||!this.state.haveUserLocation?/*#__PURE__*/React.createElement(\"video\",{className:\"video\",autoPlay:true,loop:true,src:\"https://media.giphy.com/media/xkC0zz2GObJfy/giphy.mp4\"}):/*#__PURE__*/React.createElement(CardText,null,\"Thanks for submitting a message!\")));}}]);return App;}(React.Component);export default App;","map":{"version":3,"sources":["/home/kango/Documents/MERN Projects/react-leaflet-master/client/src/App.js"],"names":["React","Map","TileLayer","Marker","Popup","L","Joi","CardText","CardBody","CardTitle","Button","Form","FormGroup","Label","Input","messagesIcon","Icon","iconUrl","messageIcon","iconSize","iconAnchor","popupAnchor","myIcons","myIcon","schema","object","keys","name","string","min","max","required","message","API_URL","window","location","hostname","App","state","lat","lng","haveUserLocation","zoom","userMessage","sendingMessage","sentMessage","messages","formIsValid","result","validate","error","formSubmitted","event","preventDefault","setState","fetch","method","headers","body","JSON","stringify","latitude","longitude","then","res","json","console","log","setTimeout","valueChanged","target","value","prevState","haveSeenLocation","reduce","all","key","toFixed","otherMessages","push","navigator","geolocation","getCurrentPosition","position","coords","lon","map","_id","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport './App.css';\n\nimport {Map, TileLayer, Marker, Popup} from 'react-leaflet'\nimport L from 'leaflet'\nimport Joi from 'joi'\n\nimport {\n    CardText, CardBody,\n    CardTitle, Button,\n    Form, FormGroup,\n    Label, Input\n} from 'reactstrap';\n\nimport messageIcon from './message-location.svg'\nimport myIcon from './my-location.svg'\n\nexport const messagesIcon = new L.Icon({\n    iconUrl: messageIcon,\n    iconSize: [35, 38],\n    iconAnchor: [13.5, 41],\n    popupAnchor: [0, -41],\n})\n\nexport const myIcons = new L.Icon({\n    iconUrl: myIcon,\n    iconSize: [35, 38],\n    iconAnchor: [13.5, 41],\n    popupAnchor: [0, -41],\n})\n\nconst schema = Joi.object().keys({\n    name: Joi.string().min(1).max(500).required(),\n    message: Joi.string().min(1).max(500).required(),\n})\n\nconst API_URL = window.location.hostname === 'localhost' ? 'http://localhost:5000/api/v1/messages' : 'production_url_here'\n\nclass App extends React.Component {\n    state = {\n        location: {\n            lat: 50.433300,\n            lng: 30.416700,\n        },\n        haveUserLocation: false,\n        zoom: 2,\n        userMessage: {\n            name: '',\n            message: ''\n        },\n        sendingMessage: false,\n        sentMessage: false,\n        messages: []\n    }\n\n    componentDidMount() {\n        fetch(API_URL)\n            .then(res => res.json())\n            .then(messages => {\n                const haveSeenLocation = {}\n                messages = messages.reduce((all, message) => {\n                    debugger;\n                    const key = `${message.latitude.toFixed(2)}${message.longitude.toFixed(2)}`\n                    if (haveSeenLocation[key]) {\n                        console.log(haveSeenLocation[key], 'key')\n                        haveSeenLocation[key].otherMessages = haveSeenLocation[key].otherMessages || []\n                        haveSeenLocation[key].otherMessages.push(message)\n                    } else {\n                        haveSeenLocation[key] = message;\n                        all.push(message);\n                    }\n                    return all;\n                }, [])\n                this.setState({\n                    messages\n                })\n            })\n\n        navigator.geolocation.getCurrentPosition((position) => {\n            this.setState({\n                location: {\n                    lat: position.coords.latitude,\n                    lng: position.coords.longitude\n                },\n                haveUserLocation: true,\n                zoom: 13,\n            })\n        }, () => {\n            console.log('uh, oh... they didnt give us their location...')\n            fetch('http://ip-api.com/json/')\n                .then(res => res.json())\n                .then(location => {\n                    this.setState({\n                        location: {\n                            lat: location.lat,\n                            lng: location.lon\n                        },\n                        haveUserLocation: true,\n                        zoom: 13\n                    })\n                })\n        });\n    }\n\n    formIsValid = () => {\n        const userMessage = {\n            name: this.state.userMessage.name,\n            message: this.state.userMessage.message\n        }\n        const result = schema.validate(userMessage)\n\n        if (this.state.haveUserLocation) {\n            if (!result.error) {\n                return true\n            }\n            return false\n        }\n    }\n\n    formSubmitted = (event) => {\n        event.preventDefault()\n        this.setState({\n            sendingMessage: true\n        })\n        if (this.formIsValid()) {\n            debugger;\n            fetch(API_URL, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    name: this.state.userMessage.name,\n                    message: this.state.userMessage.message,\n                    latitude: this.state.location.lat,\n                    longitude: this.state.location.lng\n                })\n            })\n                .then(res => res.json())\n                .then(message => {\n                    console.log(message)\n                    setTimeout(() => {\n                        this.setState({\n                            sendingMessage: false,\n                            sentMessage: true\n                        })\n                    }, 4000)\n                })\n        }\n    }\n\n    valueChanged = (event) => {\n        const {name, value} = event.target\n        this.setState((prevState) => ({\n            userMessage: {\n                ...prevState.userMessage,\n                [name]: value\n            }\n        }))\n    }\n\n    render() {\n        const position = [this.state.location.lat, this.state.location.lng]\n        return (\n            <div className=\"map\">\n                <Map className=\"map\" center={position} zoom={this.state.zoom}>\n                    <TileLayer\n                        attribution='&amp;copy <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\n                        url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n                    />\n                    {\n                        this.state.haveUserLocation\n                            ? <Marker position={position} icon={myIcons}>\n                                <Popup>\n                                    A pretty CSS3 popup. <br/> Easily customizable.\n                                </Popup>\n                            </Marker>\n                            : \"\"\n                    }\n                    {\n                        this.state.messages.map(message => {\n                            return (<Marker key={message._id} position={[message.latitude, message.longitude]} icon={messagesIcon}>\n                                <Popup>\n                                    <p><em>{message.name}</em>{message.message}</p>\n                                    { message.otherMessages ? message.otherMessages.map(message => <p key={message._id}><em>{message.name}</em> : {message.message}</p>) : \"\" }\n                                </Popup>\n                            </Marker>)\n                        })\n                    }\n                </Map>\n                <CardBody className=\"message-form\">\n                    <CardTitle>Welcome to GuestM.app</CardTitle>\n                    <CardText>Leave a message with your location!</CardText>\n                    <CardText>Thanks for stopping by!</CardText>\n                    {!this.state.sendingMessage && !this.state.sentMessage && this.state.haveUserLocation ?\n                        <Form onSubmit={this.formSubmitted}>\n                            <FormGroup>\n                                <Label for=\"name\">Name</Label>\n                                <Input\n                                    onChange={this.valueChanged}\n                                    type=\"text\"\n                                    name=\"name\"\n                                    id=\"name\"\n                                    placeholder=\"Enter your name\"/>\n                            </FormGroup>\n                            <FormGroup>\n                                <Label for=\"message\">Message</Label>\n                                <Input\n                                    onChange={this.valueChanged}\n                                    type=\"textarea\"\n                                    name=\"message\"\n                                    id=\"message\"\n                                    placeholder=\"Enter a message\"/>\n                            </FormGroup>\n                            <Button type=\"submit\" color=\"info\" disabled={!this.formIsValid()}>Send</Button>\n                        </Form>\n                        : this.state.sendingMessage || !this.state.haveUserLocation ?\n                            <video className=\"video\" autoPlay loop\n                                   src=\"https://media.giphy.com/media/xkC0zz2GObJfy/giphy.mp4\"/>\n                            : <CardText>Thanks for submitting a message!</CardText>\n                    }\n                </CardBody>\n            </div>\n        )\n    }\n}\n\nexport default App"]},"metadata":{},"sourceType":"module"}