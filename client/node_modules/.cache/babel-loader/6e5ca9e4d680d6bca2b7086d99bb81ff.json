{"ast":null,"code":"var _jsxFileName = \"/home/kango/Documents/MERN Projects/react-leaflet-master/client/src/App.js\";\nimport React from 'react';\nimport './App.css';\nimport { Map, TileLayer, Marker, Popup } from 'react-leaflet';\nimport L from 'leaflet';\nimport Joi from 'joi';\nimport { CardText, CardBody, CardTitle, Button, Form, FormGroup, Label, Input } from 'reactstrap';\nimport messageIcon from \"./message-location.svg\";\nimport myIcon from \"./my-location.svg\";\nexport const messagesIcon = new L.Icon({\n  iconUrl: messageIcon,\n  iconSize: [35, 38],\n  iconAnchor: [13.5, 41],\n  popupAnchor: [0, -41]\n});\nexport const myIcons = new L.Icon({\n  iconUrl: myIcon,\n  iconSize: [35, 38],\n  iconAnchor: [13.5, 41],\n  popupAnchor: [0, -41]\n});\nconst schema = Joi.object().keys({\n  name: Joi.string().min(1).max(500).required(),\n  message: Joi.string().min(1).max(500).required()\n});\nconst API_URL = window.location.hostname === 'localhost' ? 'http://localhost:5000/api/v1/messages' : 'production_url_here';\n\nclass App extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      location: {\n        lat: 50.433300,\n        lng: 30.416700\n      },\n      haveUserLocation: false,\n      zoom: 2,\n      userMessage: {\n        name: '',\n        message: ''\n      },\n      sendingMessage: false,\n      sentMessage: false,\n      messages: []\n    };\n\n    this.formIsValid = () => {\n      const userMessage = {\n        name: this.state.userMessage.name,\n        message: this.state.userMessage.message\n      };\n      const result = schema.validate(userMessage);\n\n      if (this.state.haveUserLocation) {\n        if (!result.error) {\n          return true;\n        }\n\n        return false;\n      }\n    };\n\n    this.formSubmitted = event => {\n      event.preventDefault();\n      this.setState({\n        sendingMessage: true\n      });\n\n      if (this.formIsValid()) {\n        debugger;\n        fetch(API_URL, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            name: this.state.userMessage.name,\n            message: this.state.userMessage.message,\n            latitude: this.state.location.lat,\n            longitude: this.state.location.lng\n          })\n        }).then(res => res.json()).then(message => {\n          console.log(message);\n          setTimeout(() => {\n            this.setState({\n              sendingMessage: false,\n              sentMessage: true\n            });\n          }, 4000);\n        });\n      }\n    };\n\n    this.valueChanged = event => {\n      const {\n        name,\n        value\n      } = event.target;\n      this.setState(prevState => ({\n        userMessage: { ...prevState.userMessage,\n          [name]: value\n        }\n      }));\n    };\n  }\n\n  componentDidMount() {\n    fetch(API_URL).then(res => res.json()).then(messages => {\n      const haveSeenLocation = {};\n      messages = messages.reduce((all, message) => {\n        debugger;\n        const key = `${message.latitude.toFixed(2)}${message.longitude.toFixed(2)}`;\n\n        if (haveSeenLocation[key]) {\n          console.log(haveSeenLocation[key], 'key');\n          haveSeenLocation[key].otherMessages = haveSeenLocation[key].otherMessages || [];\n          haveSeenLocation[key].otherMessages.push(message);\n        } else {\n          haveSeenLocation[key] = message;\n          all.push(message);\n        }\n\n        return all;\n      }, []);\n      this.setState({\n        messages\n      });\n    });\n    navigator.geolocation.getCurrentPosition(position => {\n      this.setState({\n        location: {\n          lat: position.coords.latitude,\n          lng: position.coords.longitude\n        },\n        haveUserLocation: true,\n        zoom: 13\n      });\n    }, () => {\n      console.log('uh, oh... they didnt give us their location...');\n      fetch('http://ip-api.com/json/').then(res => res.json()).then(location => {\n        this.setState({\n          location: {\n            lat: location.lat,\n            lng: location.lon\n          },\n          haveUserLocation: true,\n          zoom: 13\n        });\n      });\n    });\n  }\n\n  render() {\n    const position = [this.state.location.lat, this.state.location.lng];\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"map\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Map, {\n      className: \"map\",\n      center: position,\n      zoom: this.state.zoom,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(TileLayer, {\n      attribution: \"&copy <a href=\\\"http://osm.org/copyright\\\">OpenStreetMap</a> contributors\",\n      url: \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 21\n      }\n    }), this.state.haveUserLocation ? /*#__PURE__*/React.createElement(Marker, {\n      position: position,\n      icon: myIcons,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 31\n      }\n    }, /*#__PURE__*/React.createElement(Popup, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174,\n        columnNumber: 33\n      }\n    }, \"A pretty CSS3 popup. \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175,\n        columnNumber: 58\n      }\n    }), \" Easily customizable.\")) : \"\", this.state.messages.map(message => {\n      return /*#__PURE__*/React.createElement(Marker, {\n        key: message._id,\n        position: [message.latitude, message.longitude],\n        icon: messagesIcon,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 37\n        }\n      }, /*#__PURE__*/React.createElement(Popup, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 33\n        }\n      }, /*#__PURE__*/React.createElement(\"em\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 184,\n          columnNumber: 37\n        }\n      }, message.name), \": \", message.message));\n    })), /*#__PURE__*/React.createElement(CardBody, {\n      className: \"message-form\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(CardTitle, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 191,\n        columnNumber: 21\n      }\n    }, \"Welcome to GuestM.app\"), /*#__PURE__*/React.createElement(CardText, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 192,\n        columnNumber: 21\n      }\n    }, \"Leave a message with your location!\"), /*#__PURE__*/React.createElement(CardText, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 21\n      }\n    }, \"Thanks for stopping by!\"), !this.state.sendingMessage && !this.state.sentMessage && this.state.haveUserLocation ? /*#__PURE__*/React.createElement(Form, {\n      onSubmit: this.formSubmitted,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(FormGroup, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(Label, {\n      for: \"name\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 33\n      }\n    }, \"Name\"), /*#__PURE__*/React.createElement(Input, {\n      onChange: this.valueChanged,\n      type: \"text\",\n      name: \"name\",\n      id: \"name\",\n      placeholder: \"Enter your name\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 33\n      }\n    })), /*#__PURE__*/React.createElement(FormGroup, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(Label, {\n      for: \"message\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 33\n      }\n    }, \"Message\"), /*#__PURE__*/React.createElement(Input, {\n      onChange: this.valueChanged,\n      type: \"textarea\",\n      name: \"message\",\n      id: \"message\",\n      placeholder: \"Enter a message\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 207,\n        columnNumber: 33\n      }\n    })), /*#__PURE__*/React.createElement(Button, {\n      type: \"submit\",\n      color: \"info\",\n      disabled: !this.formIsValid(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 29\n      }\n    }, \"Send\")) : this.state.sendingMessage || !this.state.haveUserLocation ? /*#__PURE__*/React.createElement(\"video\", {\n      className: \"video\",\n      autoPlay: true,\n      loop: true,\n      src: \"https://media.giphy.com/media/xkC0zz2GObJfy/giphy.mp4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 29\n      }\n    }) : /*#__PURE__*/React.createElement(CardText, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 31\n      }\n    }, \"Thanks for submitting a message!\")));\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["/home/kango/Documents/MERN Projects/react-leaflet-master/client/src/App.js"],"names":["React","Map","TileLayer","Marker","Popup","L","Joi","CardText","CardBody","CardTitle","Button","Form","FormGroup","Label","Input","messagesIcon","Icon","iconUrl","messageIcon","iconSize","iconAnchor","popupAnchor","myIcons","myIcon","schema","object","keys","name","string","min","max","required","message","API_URL","window","location","hostname","App","Component","state","lat","lng","haveUserLocation","zoom","userMessage","sendingMessage","sentMessage","messages","formIsValid","result","validate","error","formSubmitted","event","preventDefault","setState","fetch","method","headers","body","JSON","stringify","latitude","longitude","then","res","json","console","log","setTimeout","valueChanged","value","target","prevState","componentDidMount","haveSeenLocation","reduce","all","key","toFixed","otherMessages","push","navigator","geolocation","getCurrentPosition","position","coords","lon","render","map","_id"],"mappings":"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","sourcesContent":["import React from 'react';\nimport './App.css';\n\nimport {Map, TileLayer, Marker, Popup} from 'react-leaflet'\nimport L from 'leaflet'\nimport Joi from 'joi'\n\nimport {\n    CardText, CardBody,\n    CardTitle, Button,\n    Form, FormGroup,\n    Label, Input\n} from 'reactstrap';\n\nimport messageIcon from './message-location.svg'\nimport myIcon from './my-location.svg'\n\nexport const messagesIcon = new L.Icon({\n    iconUrl: messageIcon,\n    iconSize: [35, 38],\n    iconAnchor: [13.5, 41],\n    popupAnchor: [0, -41],\n})\n\nexport const myIcons = new L.Icon({\n    iconUrl: myIcon,\n    iconSize: [35, 38],\n    iconAnchor: [13.5, 41],\n    popupAnchor: [0, -41],\n})\n\nconst schema = Joi.object().keys({\n    name: Joi.string().min(1).max(500).required(),\n    message: Joi.string().min(1).max(500).required(),\n})\n\nconst API_URL = window.location.hostname === 'localhost' ? 'http://localhost:5000/api/v1/messages' : 'production_url_here'\n\nclass App extends React.Component {\n    state = {\n        location: {\n            lat: 50.433300,\n            lng: 30.416700,\n        },\n        haveUserLocation: false,\n        zoom: 2,\n        userMessage: {\n            name: '',\n            message: ''\n        },\n        sendingMessage: false,\n        sentMessage: false,\n        messages: []\n    }\n\n    componentDidMount() {\n        fetch(API_URL)\n            .then(res => res.json())\n            .then(messages => {\n                const haveSeenLocation = {}\n                messages = messages.reduce((all, message) => {\n                    debugger;\n                    const key = `${message.latitude.toFixed(2)}${message.longitude.toFixed(2)}`\n                    if (haveSeenLocation[key]) {\n                        console.log(haveSeenLocation[key], 'key')\n                        haveSeenLocation[key].otherMessages = haveSeenLocation[key].otherMessages || []\n                        haveSeenLocation[key].otherMessages.push(message)\n                    } else {\n                        haveSeenLocation[key] = message;\n                        all.push(message);\n                    }\n                    return all;\n                }, [])\n                this.setState({\n                    messages\n                })\n            })\n\n        navigator.geolocation.getCurrentPosition((position) => {\n            this.setState({\n                location: {\n                    lat: position.coords.latitude,\n                    lng: position.coords.longitude\n                },\n                haveUserLocation: true,\n                zoom: 13,\n            })\n        }, () => {\n            console.log('uh, oh... they didnt give us their location...')\n            fetch('http://ip-api.com/json/')\n                .then(res => res.json())\n                .then(location => {\n                    this.setState({\n                        location: {\n                            lat: location.lat,\n                            lng: location.lon\n                        },\n                        haveUserLocation: true,\n                        zoom: 13\n                    })\n                })\n        });\n    }\n\n    formIsValid = () => {\n        const userMessage = {\n            name: this.state.userMessage.name,\n            message: this.state.userMessage.message\n        }\n        const result = schema.validate(userMessage)\n\n        if (this.state.haveUserLocation) {\n            if (!result.error) {\n                return true\n            }\n            return false\n        }\n    }\n\n    formSubmitted = (event) => {\n        event.preventDefault()\n        this.setState({\n            sendingMessage: true\n        })\n        if (this.formIsValid()) {\n            debugger;\n            fetch(API_URL, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    name: this.state.userMessage.name,\n                    message: this.state.userMessage.message,\n                    latitude: this.state.location.lat,\n                    longitude: this.state.location.lng\n                })\n            })\n                .then(res => res.json())\n                .then(message => {\n                    console.log(message)\n                    setTimeout(() => {\n                        this.setState({\n                            sendingMessage: false,\n                            sentMessage: true\n                        })\n                    }, 4000)\n                })\n        }\n    }\n\n    valueChanged = (event) => {\n        const {name, value} = event.target\n        this.setState((prevState) => ({\n            userMessage: {\n                ...prevState.userMessage,\n                [name]: value\n            }\n        }))\n    }\n\n    render() {\n        const position = [this.state.location.lat, this.state.location.lng]\n        return (\n            <div className=\"map\">\n                <Map className=\"map\" center={position} zoom={this.state.zoom}>\n                    <TileLayer\n                        attribution='&amp;copy <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\n                        url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n                    />\n                    {\n                        this.state.haveUserLocation\n                            ? <Marker position={position} icon={myIcons}>\n                                <Popup>\n                                    A pretty CSS3 popup. <br/> Easily customizable.\n                                </Popup>\n                            </Marker>\n                            : \"\"\n                    }\n                    {\n                        this.state.messages.map(message => {\n                            return (<Marker key={message._id} position={[message.latitude, message.longitude]} icon={messagesIcon}>\n                                <Popup>\n                                    <em>{message.name}</em>: {message.message}\n                                </Popup>\n                            </Marker>)\n                        })\n                    }\n                </Map>\n                <CardBody className=\"message-form\">\n                    <CardTitle>Welcome to GuestM.app</CardTitle>\n                    <CardText>Leave a message with your location!</CardText>\n                    <CardText>Thanks for stopping by!</CardText>\n                    {!this.state.sendingMessage && !this.state.sentMessage && this.state.haveUserLocation ?\n                        <Form onSubmit={this.formSubmitted}>\n                            <FormGroup>\n                                <Label for=\"name\">Name</Label>\n                                <Input\n                                    onChange={this.valueChanged}\n                                    type=\"text\"\n                                    name=\"name\"\n                                    id=\"name\"\n                                    placeholder=\"Enter your name\"/>\n                            </FormGroup>\n                            <FormGroup>\n                                <Label for=\"message\">Message</Label>\n                                <Input\n                                    onChange={this.valueChanged}\n                                    type=\"textarea\"\n                                    name=\"message\"\n                                    id=\"message\"\n                                    placeholder=\"Enter a message\"/>\n                            </FormGroup>\n                            <Button type=\"submit\" color=\"info\" disabled={!this.formIsValid()}>Send</Button>\n                        </Form>\n                        : this.state.sendingMessage || !this.state.haveUserLocation ?\n                            <video className=\"video\" autoPlay loop\n                                   src=\"https://media.giphy.com/media/xkC0zz2GObJfy/giphy.mp4\"/>\n                            : <CardText>Thanks for submitting a message!</CardText>\n                    }\n                </CardBody>\n            </div>\n        )\n    }\n}\n\nexport default App"]},"metadata":{},"sourceType":"module"}