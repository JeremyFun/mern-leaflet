{"ast":null,"code":"var _jsxFileName = \"/home/kango/Documents/MERN Projects/react-leaflet-master/client/src/Components/MapPage.js\";\nimport React from 'react';\nimport '../App.css';\nimport { Map, TileLayer, Marker, Popup } from 'react-leaflet';\nimport L from 'leaflet';\nimport Joi from 'joi';\nimport MessageCard from \"./MessageCard\";\nimport { getMessages, getLocation, sendMessage } from \"../API/API\";\nimport messageIcon from \"../assets/svg/message-location.svg\";\nimport myIcon from \"../assets/svg/my-location.svg\";\nimport { Button } from 'reactstrap';\nimport Basemap from \"./Basemap\";\nimport GeojsonLayer from \"./GeojsonLayer\";\nimport CoordInsert from \"./CoordInsert\";\nexport const messagesIcon = new L.Icon({\n  iconUrl: messageIcon,\n  iconSize: [50, 82]\n});\nexport const myIcons = new L.Icon({\n  iconUrl: myIcon,\n  iconSize: [50, 82]\n});\nconst schema = Joi.object().keys({\n  name: Joi.string().min(1).max(500).required(),\n  message: Joi.string().min(1).max(500).required()\n});\nexport class MapPage extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      location: {\n        lat: 50.433300,\n        lng: 30.416700\n      },\n      haveUserLocation: false,\n      zoom: 2,\n      userMessage: {\n        name: '',\n        message: ''\n      },\n      sendingMessage: false,\n      showMessage: false,\n      sentMessage: false,\n      messages: [],\n      basemap: 'osm',\n      geojsonvisible: false,\n      visibleModal: false\n    };\n\n    this.showMessage = () => {\n      this.setState({\n        showMessage: true\n      });\n    };\n\n    this.quitWithMessage = () => {\n      this.setState({\n        showMessage: false\n      });\n    };\n\n    this.formIsValid = () => {\n      const userMessage = {\n        name: this.state.userMessage.name,\n        message: this.state.userMessage.message\n      };\n      const result = schema.validate(userMessage);\n\n      if (this.state.haveUserLocation) {\n        if (!result.error) {\n          return true;\n        }\n\n        return false;\n      }\n    };\n\n    this.formSubmitted = event => {\n      event.preventDefault();\n      this.setState({\n        sendingMessage: true\n      });\n\n      if (this.formIsValid()) {\n        const message = {\n          name: this.state.userMessage.name,\n          message: this.state.userMessage.message,\n          latitude: this.state.location.lat,\n          longitude: this.state.location.lng\n        };\n        sendMessage(message).then(result => {\n          setTimeout(() => {\n            this.setState({\n              sendingMessage: false,\n              sentMessage: true\n            });\n          }, 4000);\n        });\n      }\n    };\n\n    this.valueChanged = event => {\n      const {\n        name,\n        value\n      } = event.target;\n      this.setState(prevState => ({\n        userMessage: { ...prevState.userMessage,\n          [name]: value\n        }\n      }));\n    };\n\n    this.onBMChange = bm => {\n      // console.log(this);\n      this.setState({\n        basemap: bm\n      });\n    };\n\n    this.onCoordInsertChange = (lat, lng, z) => {\n      this.setState({\n        location: {\n          lat: lat,\n          lng: lng,\n          zoom: z\n        }\n      });\n    };\n\n    this.onGeojsonToggle = e => {\n      this.setState({\n        geojsonvisible: e.currentTarget.checked\n      });\n    };\n  }\n\n  componentDidMount() {\n    getMessages().then(messages => {\n      this.setState({\n        messages,\n        zoom: 3.5\n      });\n    });\n    getLocation().then(location => {\n      this.setState({\n        location,\n        haveUserLocation: true,\n        zoom: 13\n      });\n    });\n  }\n\n  render() {\n    const position = [this.state.location.lat, this.state.location.lng];\n    const basemapsDict = {\n      osm: \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",\n      hot: \"https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png\",\n      dark: \"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}@2x.png\",\n      cycle: \"https://dev.{s}.tile.openstreetmap.fr/cyclosm/{z}/{x}/{y}.png\"\n    };\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"map\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Map, {\n      className: \"map\",\n      center: position,\n      zoom: this.state.zoom,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(TileLayer, {\n      attribution: \"&copy <a href=\\\"http://osm.org/copyright\\\">OpenStreetMap</a> contributors\",\n      url: basemapsDict[this.state.basemap],\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174,\n        columnNumber: 21\n      }\n    }), this.state.haveUserLocation ? /*#__PURE__*/React.createElement(Marker, {\n      position: position,\n      icon: myIcons,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 31\n      }\n    }, /*#__PURE__*/React.createElement(Popup, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 33\n      }\n    }, \"Here will be \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 50\n      }\n    }), \" your comment.\")) : \"\", this.state.messages.map(message => {\n      return /*#__PURE__*/React.createElement(Marker, {\n        key: message._id,\n        position: [message.latitude, message.longitude],\n        icon: messagesIcon,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 189,\n          columnNumber: 37\n        }\n      }, /*#__PURE__*/React.createElement(Popup, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 33\n        }\n      }, /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 37\n        }\n      }, /*#__PURE__*/React.createElement(\"em\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 40\n        }\n      }, message.name), message.message), message.otherMessages ? message.otherMessages.map(message => /*#__PURE__*/React.createElement(\"p\", {\n        key: message._id,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 99\n        }\n      }, /*#__PURE__*/React.createElement(\"em\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 194,\n          columnNumber: 41\n        }\n      }, message.name), \" : \", message.message)) : \"\"));\n    })), /*#__PURE__*/React.createElement(Basemap, {\n      basemap: this.state.basemap,\n      onChange: this.onBMChange,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"geojson-toggle\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      htmlFor: \"layertoggle\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 21\n      }\n    }, \"Toggle Geojson \"), /*#__PURE__*/React.createElement(\"input\", {\n      type: \"checkbox\",\n      name: \"layertoggle\",\n      id: \"layertoggle\",\n      value: this.state.geojsonvisible,\n      onChange: this.onGeojsonToggle,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 21\n      }\n    })), this.state.geojsonvisible && /*#__PURE__*/React.createElement(GeojsonLayer, {\n      url: \"geojson.json\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(CoordInsert, {\n      onllzChange: this.onCoordInsertChange,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 17\n      }\n    }), !this.state.showMessage ? /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Button, {\n      outline: true,\n      color: \"primary\",\n      onClick: this.showMessage,\n      className: \"message-form\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 218,\n        columnNumber: 29\n      }\n    }, \"Add message\")) : /*#__PURE__*/React.createElement(MessageCard, {\n      sendingMessage: this.state.sendingMessage,\n      sentMessage: this.state.sentMessage,\n      haveUserLocation: this.state.haveUserLocation,\n      formSubmitted: this.formSubmitted,\n      valueChanged: this.valueChanged,\n      formIsValid: this.formIsValid,\n      quitWithMessage: this.quitWithMessage,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 225,\n        columnNumber: 25\n      }\n    }));\n  }\n\n}","map":{"version":3,"sources":["/home/kango/Documents/MERN Projects/react-leaflet-master/client/src/Components/MapPage.js"],"names":["React","Map","TileLayer","Marker","Popup","L","Joi","MessageCard","getMessages","getLocation","sendMessage","Button","Basemap","GeojsonLayer","CoordInsert","messagesIcon","Icon","iconUrl","messageIcon","iconSize","myIcons","myIcon","schema","object","keys","name","string","min","max","required","message","MapPage","Component","state","location","lat","lng","haveUserLocation","zoom","userMessage","sendingMessage","showMessage","sentMessage","messages","basemap","geojsonvisible","visibleModal","setState","quitWithMessage","formIsValid","result","validate","error","formSubmitted","event","preventDefault","latitude","longitude","then","setTimeout","valueChanged","value","target","prevState","onBMChange","bm","onCoordInsertChange","z","onGeojsonToggle","e","currentTarget","checked","componentDidMount","render","position","basemapsDict","osm","hot","dark","cycle","map","_id","otherMessages"],"mappings":"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","sourcesContent":["import React from 'react';\nimport '../App.css';\n\nimport {Map, TileLayer, Marker, Popup} from 'react-leaflet'\nimport L from 'leaflet'\nimport Joi from 'joi'\n\nimport MessageCard from \"./MessageCard\";\n\nimport {getMessages, getLocation, sendMessage} from \"../API/API\";\n\nimport messageIcon from '../assets/svg/message-location.svg'\nimport myIcon from '../assets/svg/my-location.svg'\n\n\nimport {Button} from 'reactstrap';\nimport Basemap from \"./Basemap\";\nimport GeojsonLayer from \"./GeojsonLayer\";\nimport CoordInsert from \"./CoordInsert\";\n\n\nexport const messagesIcon = new L.Icon({\n    iconUrl: messageIcon,\n    iconSize: [50, 82],\n})\n\nexport const myIcons = new L.Icon({\n    iconUrl: myIcon,\n    iconSize: [50, 82]\n})\n\nconst schema = Joi.object().keys({\n    name: Joi.string().min(1).max(500).required(),\n    message: Joi.string().min(1).max(500).required(),\n})\n\nexport class MapPage extends React.Component {\n    state = {\n        location: {\n            lat: 50.433300,\n            lng: 30.416700,\n        },\n        haveUserLocation: false,\n        zoom: 2,\n        userMessage: {\n            name: '',\n            message: ''\n        },\n        sendingMessage: false,\n        showMessage: false,\n        sentMessage: false,\n        messages: [],\n\n        basemap: 'osm',\n\n        geojsonvisible: false,\n        visibleModal: false,\n    }\n\n    componentDidMount() {\n        getMessages()\n            .then(messages => {\n                this.setState({\n                    messages,\n                    zoom: 3.5\n                })\n            })\n        getLocation()\n            .then(location => {\n                this.setState({\n                    location,\n                    haveUserLocation: true,\n                    zoom: 13,\n                })\n            })\n    }\n\n    showMessage = () => {\n        this.setState({\n            showMessage: true\n        })\n    }\n\n    quitWithMessage = () => {\n        this.setState({\n            showMessage: false\n        })\n    }\n\n    formIsValid = () => {\n        const userMessage = {\n            name: this.state.userMessage.name,\n            message: this.state.userMessage.message\n        }\n        const result = schema.validate(userMessage)\n\n        if (this.state.haveUserLocation) {\n            if (!result.error) {\n                return true\n            }\n            return false\n        }\n    }\n\n    formSubmitted = (event) => {\n        event.preventDefault()\n        this.setState({\n            sendingMessage: true\n        })\n        if (this.formIsValid()) {\n            const message = {\n                name: this.state.userMessage.name,\n                message: this.state.userMessage.message,\n                latitude: this.state.location.lat,\n                longitude: this.state.location.lng\n            }\n            sendMessage(message)\n                .then((result) => {\n                    setTimeout(() => {\n                        this.setState({\n                            sendingMessage: false,\n                            sentMessage: true\n                        })\n                    }, 4000)\n                })\n        }\n    }\n\n    valueChanged = (event) => {\n        const {name, value} = event.target\n        this.setState((prevState) => ({\n            userMessage: {\n                ...prevState.userMessage,\n                [name]: value\n            }\n        }))\n    }\n\n    onBMChange = (bm) => {\n        // console.log(this);\n        this.setState({\n            basemap: bm\n        });\n    }\n\n    onCoordInsertChange = (lat, lng, z) => {\n        this.setState({\n            location: {\n                lat: lat,\n                lng: lng,\n                zoom: z,\n            }\n        });\n    }\n\n    onGeojsonToggle = (e) => {\n        this.setState({\n            geojsonvisible: e.currentTarget.checked\n        });\n    }\n\n    render() {\n        const position = [this.state.location.lat, this.state.location.lng]\n\n        const basemapsDict = {\n            osm: \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",\n            hot: \"https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png\",\n            dark: \"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}@2x.png\",\n            cycle: \"https://dev.{s}.tile.openstreetmap.fr/cyclosm/{z}/{x}/{y}.png\"\n        }\n        return (\n            <div className=\"map\">\n                <Map className=\"map\" center={position} zoom={this.state.zoom}>\n                    <TileLayer\n                        attribution='&amp;copy <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\n                        url={basemapsDict[this.state.basemap]}\n                    />\n                    {\n                        this.state.haveUserLocation\n                            ? <Marker position={position} icon={myIcons}>\n                                <Popup>\n                                    Here will be <br/> your comment.\n                                </Popup>\n                            </Marker>\n                            : \"\"\n                    }\n                    {\n                        this.state.messages.map(message => {\n                            return (<Marker key={message._id} position={[message.latitude, message.longitude]}\n                                            icon={messagesIcon}>\n                                <Popup>\n                                    <p><em>{message.name}</em>{message.message}</p>\n                                    {message.otherMessages ? message.otherMessages.map(message => <p key={message._id}>\n                                        <em>{message.name}</em> : {message.message}</p>) : \"\"}\n                                </Popup>\n                            </Marker>)\n                        })\n                    }\n                </Map>\n                <Basemap basemap={this.state.basemap} onChange={this.onBMChange}/>\n\n                <div className=\"geojson-toggle\">\n                    <label htmlFor=\"layertoggle\">Toggle Geojson </label>\n                    <input type=\"checkbox\"\n                           name=\"layertoggle\" id=\"layertoggle\"\n                           value={this.state.geojsonvisible} onChange={this.onGeojsonToggle}/>\n                </div>\n\n                {this.state.geojsonvisible &&\n                <GeojsonLayer url=\"geojson.json\"/>\n                }\n\n                <CoordInsert onllzChange={this.onCoordInsertChange}/>\n                {\n                    !this.state.showMessage\n                        ?\n                        <>\n                            <Button outline\n                                    color=\"primary\"\n                                    onClick={this.showMessage}\n                                    className=\"message-form\"\n                            >Add message</Button>\n                        </>\n                        :\n                        <MessageCard\n                            sendingMessage={this.state.sendingMessage}\n                            sentMessage={this.state.sentMessage}\n                            haveUserLocation={this.state.haveUserLocation}\n                            formSubmitted={this.formSubmitted}\n                            valueChanged={this.valueChanged}\n                            formIsValid={this.formIsValid}\n                            quitWithMessage={this.quitWithMessage}\n                        />\n                }\n\n            </div>\n\n        )\n    }\n}"]},"metadata":{},"sourceType":"module"}